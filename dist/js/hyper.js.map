{"version":3,"sources":["../../js/hyper.js"],"names":["staticLocalStaffList","timeTable","staticNameList","scheduleHistoryHtml","$","document","ready","init","initPopovers","bindEvents","bindDrawLine","sessionStorage","authorized","modal","bootstrapSwitch","state","$chart","find","children","show","hide","addClass","removeClass","makeDraggable","callback","text","Date","toLocaleDateString","replace","requestStaff","requestSchedule","requestScheduleList","post","data","status","json","JSON","parse","code","staff_real","loadStaffList","staff_in_order","toast","showHideTransition","icon","heading","msg","hideAfter","id","constructChart","datatime","content","translateElement","loadCheck","list","contentHtml","forEach","item","substr","time","arrayParam","chartArray","a","Array","$schedule","html","append","tableHtml","periodArray","indexPeriod","teamArray","indexTeam","String","fromCharCode","staffId","parseInt","staff","name","element","career","alert","popover","placement","trigger","on","addStaff","saveStaff","deleteStaff","e","readStaffAttributes","filterStaff","type","keyCode","$list","key","val","trim","filter","$cell","css","modalHeight","window","height","focus","addName","checkAuth","$table","parentsUntil","count","length","resizeSVG","$tr","eq","remove","insertBefore","html2canvas","get","then","canvas","attr","toDataURL","stopPropagation","experience","$enter","$help","prop","authorize","auth","target","getAttribute","resetStaffAttributesPanel","index_namelist","indexOf","absence","attack","control","each","index","staffList","$staff_list","empty","push","elementNode","createElement","setAttribute","className","innerHTML","loadNameList","$name_select","Option","$staff","$target","$current","hasClass","removeAttr","filterConditions","$filterInputs","parent","$btn_list","increment","exist","is","toString","$input","$modal","batchLeave","idList","$checkList","method","click","calculateElement","scale","arguments","span","$obj","$staff_btn","Math","round","random","textDeleted","splice","undoDeleteStaff","idDeleted","saveSchedule","extractSchedule","scheduleArray","staffArray","$td","$object","$handle","jQuery","isMove","X","Y","pageX","pageY","left","top","width","body","scrollWidth","scrollHeight","isDraw","isDrop","isExchange","$svg","$buttons","x1","y1","x2","y2","setTimeout","staff_id","staff_name","staff_text","staff_element","this_id","this_name","this_text","this_element","markDuplicate","id_replaced","$contain","$staff_in","map"],"mappings":"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","file":"hyper.js","sourcesContent":["'use strict';\r\nlet staticLocalStaffList = null;\r\nconst timeTable = ['20:00', '20:30', '21:00', '21:30', '22:00', '22:30', '23:00', '23:30', '0:00', '0:30'];\r\nlet staticNameList = [];\r\nlet scheduleHistoryHtml = \"\";\r\n\r\n$(document).ready(function () {\r\n    init(function () {\r\n        // init popovers\r\n        initPopovers();\r\n        // bind events\r\n        bindEvents();\r\n        // bind draw line\r\n        bindDrawLine();\r\n\r\n        // show modal authorize\r\n        if (typeof sessionStorage.authorized === \"undefined\") {\r\n            $(\"div#modal_authorize\").modal('show');\r\n        }\r\n    });\r\n\r\n    // init switch edit_lock\r\n    $(\"input#edit_lock\").bootstrapSwitch({\r\n        'state': false,\r\n        'size': 'small',\r\n        'labelText':'表',\r\n        'onText': '\\u2714',\r\n        'offText': '\\u2718',\r\n        'onSwitchChange': function () {\r\n            let state = $(\"input#edit_lock\").bootstrapSwitch('state');\r\n            let $chart = $('div#schedule');\r\n            if (state === true) {\r\n                $chart.find('table thead th').children('span').show();\r\n                $chart.children('div').show();\r\n            } else if (state === false) {\r\n                $chart.find('table thead th').children('span').hide();\r\n                $chart.children('div').hide();\r\n            }\r\n        }\r\n    });\r\n\r\n    // init switch element_lock\r\n    $(\"input#element_lock\").bootstrapSwitch({\r\n        'state': false,\r\n        'size': 'small',\r\n        'labelText':'属',\r\n        'onText': '\\u2714',\r\n        'offText': '\\u2718',\r\n        'onSwitchChange': function () {\r\n            let state = $(\"input#element_lock\").bootstrapSwitch('state');\r\n            let $chart = $('div#schedule');\r\n            if (state === true) {\r\n                $chart.addClass(\"element-on\");\r\n            } else if (state === false) {\r\n                $chart.removeClass(\"element-on\");\r\n            }\r\n        }\r\n    });\r\n\r\n    // make draggable\r\n    makeDraggable($('div#staff_list'), $(\"button#staff_list_move_handle\"));\r\n});\r\n\r\n/**\r\n * request data from server\r\n * @param callback called on completion\r\n */\r\nfunction init(callback) {\r\n    $(\"div#schedule\").children('h3').text(new Date().toLocaleDateString().replace(/\\//g, '-'));\r\n    // load from server\r\n    requestStaff(function () {\r\n        requestSchedule(null, callback);\r\n    });\r\n    requestScheduleList();\r\n}\r\n\r\n/**\r\n * request staff list from server\r\n * @param callback called on completion\r\n */\r\nfunction requestStaff(callback) {\r\n    $.post(\"php/StaffList.php\", function (data, status) {\r\n        if (status === \"success\") {\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // local list\r\n                staticLocalStaffList = json.data.staff_real;\r\n                // load staff\r\n                loadStaffList(json.data.staff_in_order);\r\n                // toast when not on load\r\n                $.toast({\r\n                    text: \"已获取最新团员列表\",\r\n                    showHideTransition: 'fade',\r\n                    icon: \"info\"\r\n                });\r\n            } else {\r\n                // alert error\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n            // callback\r\n            if (callback !== null && typeof callback === \"function\") {\r\n                callback();\r\n            }\r\n        } else {\r\n            // alert fail\r\n            $.toast({\r\n                heading: \"获取团员列表失败\",\r\n                text: \"请稍后尝试刷新页面\",\r\n                showHideTransition: 'fade',\r\n                icon: \"error\",\r\n                hideAfter: false\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * if id is not null, request corresponding schedule; else request the newest\r\n * @param id id of schedule\r\n * @param callback called on completion\r\n */\r\nfunction requestSchedule(id, callback) {\r\n    $.post(\"php/ScheduleSL.php\", {\r\n        \"method\": \"load\",\r\n        \"id\": id\r\n    }, function (data, status) {\r\n        if (status === \"success\") {\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // construct chart\r\n                if (json.data) {\r\n                    constructChart(json.data.datatime, json.data.content);\r\n                    // paint element\r\n                    translateElement(true);\r\n                    // load check\r\n                    loadCheck();\r\n                }\r\n                // toast when not on load\r\n                if (callback == null) {\r\n                    $.toast({\r\n                        text: \"排表载入完成\",\r\n                        showHideTransition: 'fade',\r\n                        icon: \"info\"\r\n                    });\r\n                }\r\n            } else {\r\n                // alert error\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n            // callback\r\n            if (callback !== null && typeof callback === \"function\") {\r\n                callback();\r\n            }\r\n        } else {\r\n            // alert fail\r\n            $.toast({\r\n                heading: \"获取排表失败\",\r\n                text: \"请稍后尝试刷新页面\",\r\n                showHideTransition: 'fade',\r\n                icon: \"error\",\r\n                hideAfter: false\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * request schedule list from server, and form it into html string\r\n * @returns {string} html string\r\n */\r\nfunction requestScheduleList() {\r\n    $.post(\"php/ScheduleList.php\", function (data, status) {\r\n        if (status === \"success\") {\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // construct chart\r\n                if (json.data) {\r\n                    // construct list\r\n                    let list = json.data;\r\n                    let contentHtml = \"<ul>\";\r\n                    list.forEach(function (item) {\r\n                        contentHtml += \"<li><a class='schedule-history' data-id=\\\"\" + item.id + \"\\\">\" + item.datatime.substr(0, 10) + \"</a></li>\";\r\n                    });\r\n                    contentHtml += \"</ul>\";\r\n                    scheduleHistoryHtml = contentHtml;\r\n                } else {\r\n                    // no data\r\n                    scheduleHistoryHtml = \"暂无排表历史\";\r\n                }\r\n            } else {\r\n                scheduleHistoryHtml = \"暂无排表历史\";\r\n                // alert error\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n        } else {\r\n            scheduleHistoryHtml = \"暂无排表历史\";\r\n            // alert fail\r\n            $.toast({\r\n                heading: \"获取排表历史失败\",\r\n                text: \"请稍后尝试刷新页面\",\r\n                showHideTransition: 'fade',\r\n                icon: \"error\",\r\n                hideAfter: false\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * construct chart\r\n * @param time chart data time\r\n * @param arrayParam array of the whole chart\r\n * @returns {boolean} false if chartArray is in wrong format\r\n */\r\nfunction constructChart(time, arrayParam) {\r\n    let chartArray = JSON.parse(arrayParam.replace(/[\\u4e00-\\u9fa5\\w]+/g, function (a) {\r\n        return '\"' + a + '\"';\r\n    }));\r\n    if (chartArray instanceof Array) {\r\n        // clear schedule\r\n        let $schedule = $(\"div#schedule\");\r\n        $schedule.html(\"\");\r\n        // add time and search box\r\n        $schedule.append('<h3 class=\"text-center\">' + time.substr(0, 10) + '</h3>');\r\n        $schedule.append('<input title=\"在排表区查找对象\" type=\"search\" class=\"pull-right\" id=\"schedule_search\" autocomplete=\"off\">');\r\n        let tableHtml = '';\r\n        // chartArray is the whole schedule\r\n        chartArray.forEach(function (periodArray, indexPeriod) {\r\n            if (periodArray instanceof Array) {\r\n                // periodArray是一个时间段，对应table\r\n                tableHtml += '<table class=\"table table-bordered text-center\"><thead><tr>\\n' +\r\n                    ' <th class=\"bg-success\">' + timeTable[indexPeriod] + '\\n' +\r\n                    '     <span class=\"pull-right\" style=\"display: none;\">\\n' +\r\n                    '         <button title=\"在该时间段末尾增加一个团\" type=\"button\" class=\"btn btn-info btn-xxs\" name=\"row-add\">\\n' +\r\n                    '             <span class=\"glyphicon glyphicon-plus\"></span>\\n' +\r\n                    '         </button>\\n' +\r\n                    '         <button title=\"将该时间段末尾的团删去\" type=\"button\" class=\"btn btn-info btn-xxs\" name=\"row-delete\">\\n' +\r\n                    '             <span class=\"glyphicon glyphicon-minus\"></span>\\n' +\r\n                    '         </button>\\n' +\r\n                    '     </span>\\n' +\r\n                    ' </th>\\n' +\r\n                    ' <th class=\"text-center\" colspan=\"4\">光</th>\\n' +\r\n                    ' <th class=\"text-center\" colspan=\"4\">暗</th>\\n' +\r\n                    ' </tr></thead><tbody>';\r\n                periodArray.forEach(function (teamArray, indexTeam) {\r\n                    if (teamArray instanceof Array) {\r\n                        // teamArray是一个队，对应tr\r\n                        tableHtml += '<tr><th scope=\"row\">' + String.fromCharCode(65 + indexTeam) + '</th>';\r\n                        teamArray.forEach(function (staffId) {\r\n                            staffId = parseInt(staffId);\r\n                            if (staffId === 0) {\r\n                                // add null td\r\n                                tableHtml += '<td></td>';\r\n                            } else {\r\n                                // staff是一个团员id，对应td\r\n                                let staff = staticLocalStaffList[staffId - 1];\r\n                                if (parseInt(staff.id) === staffId) {\r\n                                    tableHtml += '<td data-id=\"' + staff.id + '\" data-name=\"' + staff.name + '\" data-element=\"' + staff.element + '\">' + staff.name + staff.career + '</td>';\r\n                                } else {\r\n                                    // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n                                    alert(\"错误代码604，请告知小明\");\r\n                                }\r\n                            }\r\n                        });\r\n                        tableHtml += '</tr>';\r\n                    } else {\r\n                        // wrong format\r\n                        return false;\r\n                    }\r\n                });\r\n                tableHtml += '</tbody></table>';\r\n            } else {\r\n                // wrong format\r\n                return false;\r\n            }\r\n        });\r\n        $schedule.append(tableHtml);\r\n        $schedule.append('<div class=\"text-center\" style=\"margin-bottom: 15px;display: none;\">\\n' +\r\n            ' <button title=\"末尾增加一个时间段\" type=\"button\" class=\"btn btn-primary btn-sm\" name=\"chart-add\">\\n' +\r\n            '     <span class=\"glyphicon glyphicon-plus\"></span>\\n' +\r\n            ' </button>\\n' +\r\n            ' <button title=\"删去末尾的时间段\" type=\"button\" class=\"btn btn-primary btn-sm\" name=\"chart-delete\">\\n' +\r\n            '     <span class=\"glyphicon glyphicon-minus\"></span>\\n' +\r\n            ' </button></div>');\r\n    } else {\r\n        // wrong format\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * init popovers\r\n */\r\nfunction initPopovers() {\r\n    $(\"button#staff_list_add_btn\").popover({\r\n        content: \"一次只能新增一个空白团员\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', addStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"button#staff_attr_save_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', saveStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"button#staff_attr_del_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', deleteStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"button#schedule_history_btn\").popover({\r\n        content: scheduleHistoryHtml,\r\n        html: true,\r\n        placement: \"bottom\",\r\n        trigger: \"focus\"\r\n    });\r\n\r\n    $(\"button#staff_list_batch_leave\").popover({\r\n        content: \"对已选择团员进行：\"\r\n        + \"<div style='display: flex;justify-content: space-between;margin:0.25rem auto;'>\"\r\n        + \"<button class='btn btn-info' onclick='batchLeave(\\\"leave\\\");'>请假</button>\"\r\n        + \"<button class='btn btn-info' onclick='batchLeave(\\\"return\\\");'>销假</button></div>\",\r\n        html: true,\r\n        placement: 'top',\r\n        trigger: 'click'\r\n    });\r\n}\r\n\r\n/**\r\n * bind events\r\n */\r\nfunction bindEvents() {\r\n    let $schedule = $(\"div#schedule\");\r\n    // click on a staff button to read its attributes\r\n    $(\"div#staff_list\").children(\"div\").on('click', 'button', function (e) {\r\n        readStaffAttributes(e);\r\n    });\r\n\r\n    // filter staff\r\n    $(\"div#staff_list_filter\").find(\"input[name='options']\").on('change', filterStaff);\r\n\r\n    // search\r\n    $(\"input#staff_search\").on('change keydown', function (e) {\r\n        if (e.type === \"keydown\" && e.keyCode !== 13) return;\r\n        let $list = $(\"div#staff_list\").children(\"div\").children(\"button\");\r\n        let key = $(this).val().trim();\r\n        if (key === \"\") {\r\n            $list.show();\r\n        } else {\r\n            $list.hide().filter(\":contains(\" + key + \")\").show();\r\n        }\r\n    });\r\n    $schedule.on('change keydown', \"input#schedule_search\", function (e) {\r\n        if (e.type === \"keydown\" && e.keyCode !== 13) return;\r\n        let $cell = $(\"div#schedule\").find(\"tbody tr td\");\r\n        let key = $(this).val().trim();\r\n        if (key === \"\") {\r\n            $cell.removeClass(\"schedule-search-result\");\r\n        } else {\r\n            $cell.removeClass(\"schedule-search-result\").filter(\":contains(\" + key + \")\").addClass(\"schedule-search-result\");\r\n        }\r\n    });\r\n\r\n    // modal\r\n    $('div#modal_add_name').on('show.bs.modal', function () {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('div#modal_add_name').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    }).on(\"shown.bs.modal\", function () {\r\n        $(\"input#modal_add_name_input\").focus();\r\n    });\r\n    $(\"input#modal_add_name_input\").on('keydown', function (e) {\r\n        if (e.keyCode === 13) {\r\n            addName();\r\n        }\r\n    });\r\n    $('div#modal_authorize').on('show.bs.modal', function () {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('div#modal_authorize').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    }).on(\"shown.bs.modal\", function () {\r\n        $(\"input#modal_authorize_input\").focus();\r\n    });\r\n    $(\"input#modal_authorize_input\").on('keydown', function (e) {\r\n        if (e.keyCode === 13) {\r\n            checkAuth();\r\n        }\r\n    });\r\n\r\n    // row/chart add&delete\r\n    $schedule.on('click', \"[name='row-add']\", function () {\r\n        let $table = $(this).parentsUntil('div#schedule').filter('table');\r\n        let count = $table.find('tbody tr').length;\r\n        if (count >= 7) return;// max support 7 rows per chart\r\n        $table.append('<tr><th scope=\"row\">' + String.fromCharCode(65 + count) + '队</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>');\r\n        resizeSVG();\r\n    }).on('click', \"[name='row-delete']\", function () {\r\n        let $tr = $(this).parentsUntil('div#schedule').filter('table').find('tbody tr');\r\n        let count = $tr.length;\r\n        if (count <= 1) return;// min support 1 row per chart\r\n        $tr.eq(count - 1).remove();\r\n        resizeSVG();\r\n    }).on('click', \"[name='chart-add']\", function () {\r\n        let count = $(\"div#schedule\").children(\"table\").length;\r\n        if (count >= 10) return;// max support 10 charts\r\n        $(\"<table class=\\\"table table-bordered text-center\\\">\\n\" +\r\n            \"<thead>\\n\" +\r\n            \"<tr>\\n\" +\r\n            \"    <th class=\\\"bg-success\\\">\" + timeTable[count] + \"\\n\" +\r\n            \"        <span class=\\\"pull-right\\\">\\n\" +\r\n            \"            <button title=\\\"在该时间段末尾增加一个团\\\"  type=\\\"button\\\" class=\\\"btn btn-info btn-xxs\\\" name=\\\"row-add\\\">\\n\" +\r\n            \"                <span class=\\\"glyphicon glyphicon-plus\\\"></span>\\n\" +\r\n            \"            </button>\\n\" +\r\n            \"            <button title=\\\"将该时间段末尾的团删去\\\" type=\\\"button\\\" class=\\\"btn btn-info btn-xxs\\\" name=\\\"row-delete\\\">\\n\" +\r\n            \"                <span class=\\\"glyphicon glyphicon-minus\\\"></span>\\n\" +\r\n            \"            </button>\\n\" +\r\n            \"        </span>\\n\" +\r\n            \"    </th>\\n\" +\r\n            \"    <th class=\\\"text-center\\\" colspan=\\\"4\\\">光</th>\\n\" +\r\n            \"    <th class=\\\"text-center\\\" colspan=\\\"4\\\">暗</th>\\n\" +\r\n            \"</tr>\\n\" +\r\n            \"</thead>\\n\" +\r\n            \"<tbody>\\n\" +\r\n            \"<tr>\\n\" +\r\n            \"    <th scope=\\\"row\\\">A队</th>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"</tr>\\n\" +\r\n            \"</tbody>\\n\" +\r\n            \"</table>\").insertBefore(\"div#schedule>div\");\r\n        resizeSVG();\r\n    }).on('click', \"[name='chart-delete']\", function () {\r\n        let $table = $(\"div#schedule\").children(\"table\");\r\n        let count = $table.length;\r\n        if (count <= 1) return;// min support 1 chart\r\n        $table.eq(count - 1).remove();\r\n        resizeSVG();\r\n    });\r\n\r\n    // export\r\n    $(\"button#export_btn\").on(\"click\", function () {\r\n        html2canvas($(\"div#schedule\").get(0)).then(function (canvas) {\r\n            $(\"img#screen_shot_img\").attr(\"src\", canvas.toDataURL());\r\n        });\r\n        $(\"div#modal_img\").modal(\"show\");\r\n    });\r\n\r\n    // load schedule history\r\n    $(\".page-header\").on(\"click\", \"a.schedule-history\", function () {\r\n        let id = $(this).attr(\"data-id\");\r\n        requestSchedule(id, null);\r\n    });\r\n\r\n    // batch leave & return\r\n    $(\"button#staff_list_batch_leave\").on('click', function () {\r\n        if ($(this).attr(\"data-clicked\") === \"0\") {\r\n            $(\"div#staff_list\").children('div').children('button').append(\" <input class='batch_leave' type='checkbox'>\");\r\n            // stop propagation of checkboxes\r\n            $(\"input.batch_leave\").on(\"click\", function (e) {\r\n                e.stopPropagation();\r\n            });\r\n            $(this).text(\"退出管理\");\r\n            $(this).attr(\"data-clicked\", \"1\");\r\n        } else {\r\n            $(\"input.batch_leave\").remove();\r\n            $(this).text(\"批量管理\");\r\n            $(this).attr(\"data-clicked\", \"0\");\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * experience. have none access to save changes\r\n */\r\nfunction experience() {\r\n    sessionStorage.authorized = \"false\";\r\n    $(\"div#modal_authorize\").modal('hide');\r\n}\r\n\r\n/**\r\n * check auth.\r\n */\r\nfunction checkAuth() {\r\n    let code = $(\"input#modal_authorize_input\").val().trim();\r\n    let $enter = $(\"button#btn_auth_enter\");\r\n    // clear help block\r\n    let $help = $(\"span#helpBlock\");\r\n\r\n    $.post(\"php/AuthCheck.php\", {\r\n        \"auth\": code\r\n    }, function (data, status) {\r\n        if (status === \"success\") {\r\n            // success message\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // correct auth code\r\n                if (parseInt(json.data) === 1) {\r\n                    $help.html('<b>团员授权</b>：只可保存团员区改动');\r\n                    $enter.prop(\"disabled\", false);\r\n                } else if (parseInt(json.data) === 2) {\r\n                    $help.html('<b>团长授权</b>：可保存所有改动');\r\n                    $enter.prop(\"disabled\", false);\r\n                }\r\n            } else if (json.code === 2) {\r\n                // wrong auth code\r\n                $help.text('授权码不对，无保存权限，请联系小明');\r\n                $enter.prop(\"disabled\", true);\r\n            } else {\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * authorize. set session authorization and enter.\r\n */\r\nfunction authorize() {\r\n    sessionStorage.auth = $(\"input#modal_authorize_input\").val().trim();\r\n    sessionStorage.authorized = \"true\";\r\n    $(\"div#modal_authorize\").modal('hide');\r\n}\r\n\r\n/**\r\n * when a staff button is clicked, load his attributes\r\n * @param e event object\r\n */\r\nfunction readStaffAttributes(e) {\r\n    let id = parseInt(e.target.getAttribute(\"data-id\"));\r\n    $(\"div#staff_attr_panel\").attr(\"data-id\", id);\r\n    // new staff\r\n    if (id === 0) {\r\n        // reset attributes group\r\n        resetStaffAttributesPanel();\r\n        return;\r\n    }\r\n    // read local attributes\r\n    let staff = staticLocalStaffList[id - 1];\r\n    if (parseInt(staff.id) === id) {\r\n        // main attributes\r\n        let index_namelist = staticNameList.indexOf(staff.name);\r\n        $(\"select#staff_attr_name_select\").val(index_namelist);\r\n        $(\"input#staff_attr_career_input\").val(staff.career);\r\n        $(\"select#staff_attr_type_select\").val(staff.type);\r\n        $(\"input#staff_attr_absence_check\").prop(\"checked\", staff.absence === '1');\r\n        // other attributes\r\n        $(\"div#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(staff.attack - 1).addClass(\"active\");\r\n        $(\"div#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(staff.control - 1).addClass(\"active\");\r\n        $(\"div#staff_attr_other_element\").children(\"label\").removeClass(\"active\").each(function () {\r\n            if ((8 >> $(this).index() & staff.element) > 0) {\r\n                $(this).addClass(\"active\");\r\n            }\r\n        })\r\n    } else {\r\n        // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        alert(\"错误代码600，请告知小明\");\r\n    }\r\n}\r\n\r\n/**\r\n * reset staff attributes panel\r\n */\r\nfunction resetStaffAttributesPanel() {\r\n    $(\"select#staff_attr_name_select\").val(-1);\r\n    $(\"input#staff_attr_career_input\").val(\"\");\r\n    $(\"select#staff_attr_type_select\").val(0);\r\n    $(\"input#staff_attr_absence_check\").prop(\"checked\", false);\r\n    $(\"div#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n    $(\"div#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n}\r\n\r\n/**\r\n * load staff list on the left from local json\r\n */\r\nfunction loadStaffList(staffList) {\r\n    let $staff_list = $(\"div#staff_list\").children(\"div\");\r\n    $staff_list.empty();\r\n    $.each(staffList, function (index, item) {\r\n        // add to nameList\r\n        if (staticNameList.indexOf(item.name) === -1) {\r\n            staticNameList.push(item.name);\r\n        }\r\n\r\n        // load staff\r\n        let elementNode = document.createElement(\"button\");\r\n        elementNode.setAttribute(\"type\", \"button\");\r\n        elementNode.setAttribute(\"data-id\", item.id);\r\n        elementNode.setAttribute(\"data-element\", item.element);\r\n        elementNode.className = \"btn btn-default\";\r\n        elementNode.innerHTML = item.name + item.career;\r\n        if (item.type === '1') {\r\n            elementNode.className += \" career-c\";\r\n        } else if (item.type === '2') {\r\n            elementNode.className += \" career-assist\";\r\n        } else if (item.type === '3') {\r\n            elementNode.className += \" career-priest\";\r\n        }\r\n        if (item.absence === '1') {\r\n            elementNode.className += \" career-absence\";\r\n        }\r\n        $staff_list.append(elementNode);\r\n    });\r\n    resizeSVG();\r\n    loadNameList();\r\n    resetStaffAttributesPanel();\r\n}\r\n\r\n/**\r\n * create name select widget from static list\r\n */\r\nfunction loadNameList() {\r\n    let $name_select = $(\"select#staff_attr_name_select\");\r\n    $name_select.empty();\r\n    $name_select.append(new Option(\"称谓\", \"-1\"));\r\n    $.each(staticNameList, function (index, item) {\r\n        $name_select.append(new Option(item, index));\r\n    });\r\n}\r\n\r\n/**\r\n * check '.in-schedule' from schedule and check '.absence' from staff list\r\n */\r\nfunction loadCheck() {\r\n    let $cell = $(\"div#schedule\").find(\"tbody tr td\");\r\n    let $staff = $(\"div#staff_list\").children(\"div\").find(\"button\");\r\n    // reset in-schedule\r\n    $staff.removeClass(\"in-schedule\");\r\n    $cell.each(function () {\r\n        let text = $(this).text();\r\n        if (text === null || text === \"\" || text === \"空\") return;\r\n        let $target = $staff.filter(\":contains(\" + text + \")\");\r\n        let $current = $(this);\r\n        $target.each(function () {\r\n            if ($(this).text() === text) {\r\n                if ($(this).hasClass(\"career-absence\")) {\r\n                    $current.removeAttr(\"data-id\").removeAttr(\"data-name\").attr(\"class\", \"\").text(\"\");\r\n                } else if (!$(this).hasClass(\"in-schedule\")) {\r\n                    $(this).addClass(\"in-schedule\");\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * filter staff list according to the checkboxes\r\n */\r\nfunction filterStaff() {\r\n    let filterConditions = [\".career-c\", \".career-assist\", \".career-priest\", \".in-schedule\", \".career-absence\"];\r\n\r\n    let $staff_list = $(\"div#staff_list\");\r\n    // show all\r\n    $staff_list.find(\"button[data-id]\").show();\r\n\r\n    // filter hide\r\n    let $filterInputs = $(\"div#staff_list_filter\").find(\"input\");\r\n    $filterInputs.each(function () {\r\n        let index = parseInt($(this).attr(\"data-filter\"));\r\n        if (!$(this).parent().hasClass('active')) {\r\n            // hide\r\n            $(\"div#staff_list\").find(filterConditions[index - 1]).hide();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * add a blank staff button\r\n */\r\nfunction addStaff() {\r\n    let $btn_list = $(\"div#staff_list\").children('div');\r\n    let increment = 0;\r\n    let exist = $btn_list.children(\"button\").is(\"[data-id=\" + increment + \"]\");\r\n    if (exist) {\r\n        $(\"button#staff_list_add_btn\").popover('show');\r\n        return;\r\n    }\r\n    let elementNode = document.createElement(\"button\");\r\n    elementNode.setAttribute(\"type\", \"button\");\r\n    elementNode.setAttribute(\"data-id\", increment.toString());\r\n    elementNode.className = \"btn btn-default\";\r\n    elementNode.innerHTML = \"新增人员\";\r\n    $btn_list.append(elementNode);\r\n}\r\n\r\n/**\r\n * add a new staff name to static list\r\n * and reload the name select widget\r\n */\r\nfunction addName() {\r\n    let $input = $(\"input#modal_add_name_input\");\r\n    let name = $input.val().trim();\r\n    let $modal = $(\"div#modal_add_name\");\r\n    if (name === null || name === '') {\r\n        $modal.modal('hide');\r\n        return;\r\n    }\r\n    staticNameList.push(name);\r\n    loadNameList();\r\n    $(\"select#staff_attr_name_select\").val(staticNameList.length - 1);\r\n    $modal.modal('hide');\r\n    $input.val('');\r\n}\r\n\r\n/**\r\n * set absence in batch\r\n * @param type \"leave\" leave; \"return\" return\r\n */\r\nfunction batchLeave(type) {\r\n    let idList = [];\r\n    let $checkList = $(\"input.batch_leave:checked\").parent();\r\n    $checkList.each(function () {\r\n        idList.push($(this).attr(\"data-id\"));\r\n    });\r\n    let method = null;\r\n    if (type === \"leave\") {\r\n        method = \"batch_leave\";\r\n    } else {\r\n        method = \"batch_return\";\r\n    }\r\n\r\n    if (sessionStorage.authorized === \"true\") {\r\n        $.post(\"php/StaffAttr.php\", {\r\n            auth: sessionStorage.auth,\r\n            method: method,\r\n            idList: idList\r\n        }, function (data, status) {\r\n            if (status === \"success\") {\r\n                // success message\r\n                let json = JSON.parse(data);\r\n                if (json.code === 0) {\r\n                    // reload staff list\r\n                    requestStaff(loadCheck);\r\n                    $.toast({\r\n                        text: \"批量\" + (type === \"leave\" ? \"请假\" : \"销假\") + \"成功\",\r\n                        showHideTransition: 'fade',\r\n                        icon: \"success\"\r\n                    });\r\n                } else if (json.code === 5) {\r\n                    // alert NO AUTH\r\n                    $.toast({\r\n                        heading: \"权限不足\",\r\n                        text: \"需要团员以上权限才可操作，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"warning\"\r\n                    });\r\n                } else {\r\n                    $.toast({\r\n                        heading: \"批量\" + (type === \"leave\" ? \"请假\" : \"销假\") + \"失败\",\r\n                        text: json.msg,\r\n                        showHideTransition: 'fade',\r\n                        icon: \"error\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        $checkList.filter(\":not(.career-absence)\").addClass(\"career-absence\");\r\n\r\n        // alert NO AUTH\r\n        $.toast({\r\n            heading: \"无此权限\",\r\n            text: \"体验账号所做修改仅限于页面，不会提交到服务器，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n            showHideTransition: 'fade',\r\n            hideAfter: false,\r\n            icon: \"warning\"\r\n        });\r\n    }\r\n\r\n    $(\"button#staff_list_batch_leave\").popover('hide').click();\r\n}\r\n\r\n/**\r\n * calculate staff's element\r\n * @returns {number} element number, range 0 ~ 15\r\n */\r\nfunction calculateElement() {\r\n    let element = 0;\r\n    $(\"div#staff_attr_other_element\").find('label.active').each(function () {\r\n        element += 8 >> $(this).index();\r\n    });\r\n    return element;\r\n}\r\n\r\n/**\r\n * translate element into span dots\r\n * @param scale boolean. true:wholly, false:partly. if false, a root object is needed\r\n */\r\nfunction translateElement(scale) {\r\n    if (scale) {\r\n        $(\"div#schedule\").find(\"tr td\").each(function () {\r\n            translateElement(false, $(this));\r\n        });\r\n    } else {\r\n        if (typeof arguments[1] === \"object\") {\r\n            let span = \"\";\r\n            let $obj = arguments[1];\r\n            let element = $obj.attr(\"data-element\");\r\n            if (element) {\r\n                span += (element & 8) > 0 ? '<span class=\"element element-flame\"></span>' : \"\";\r\n                span += (element & 4) > 0 ? '<span class=\"element element-dark\"></span>' : \"\";\r\n                span += (element & 2) > 0 ? '<span class=\"element element-light\"></span>' : \"\";\r\n                span += (element & 1) > 0 ? '<span class=\"element element-ice\"></span>' : \"\";\r\n                $obj.append(span);\r\n            }\r\n        } else {\r\n            // Error 80x:参数传递错误\r\n            alert(\"错误代码801，请告知小明\");\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * save the attribute changes to local\r\n * and refresh the corresponding button\r\n */\r\nfunction saveStaff() {\r\n    let id = parseInt($(\"div#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"div#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $('button#staff_attr_save_btn').popover('show');\r\n        return;\r\n    }\r\n    // read staff\r\n    let data = {\r\n        \"method\": \"save\",\r\n        \"auth\": sessionStorage.auth,\r\n        \"id\": id,\r\n        \"name\": staticNameList[parseInt($(\"select#staff_attr_name_select\").val())],\r\n        \"career\": $(\"input#staff_attr_career_input\").val().trim(),\r\n        \"type\": parseInt($(\"select#staff_attr_type_select\").val()),\r\n        \"absence\": $(\"input#staff_attr_absence_check\").prop('checked'),\r\n        \"attack\": $(\"div#staff_attr_other_attack\").find('label.active').index() + 1,\r\n        \"control\": $(\"div#staff_attr_other_control\").find('label.active').index() + 1,\r\n        \"element\": calculateElement()\r\n    };\r\n\r\n    // submit changes\r\n    if (sessionStorage.authorized === \"true\") {\r\n        $.post(\"php/StaffAttr.php\", data, function (data, status) {\r\n            if (status === \"success\") {\r\n                // success message\r\n                let json = JSON.parse(data);\r\n                if (json.code === 0) {\r\n                    // reload staff list\r\n                    requestStaff(loadCheck);\r\n                    $.toast({\r\n                        text: \"保存成功\",\r\n                        showHideTransition: 'fade',\r\n                        icon: \"success\"\r\n                    });\r\n                } else if (json.code === 5) {\r\n                    // alert NO AUTH\r\n                    $.toast({\r\n                        heading: \"权限不足\",\r\n                        text: \"需要团员以上权限才可操作，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"warning\"\r\n                    });\r\n                } else {\r\n                    $.toast({\r\n                        heading: \"保存失败\",\r\n                        text: json.msg,\r\n                        showHideTransition: 'fade',\r\n                        icon: \"error\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        if (data.id === 0) {\r\n            // add to local json\r\n            data.id = Math.round(Math.random() * 100) + staticLocalStaffList.length;\r\n            staticLocalStaffList.push(data);\r\n            // refresh staff button\r\n            $staff_btn.attr(\"data-id\", data.id);\r\n        }\r\n        $staff_btn.text(data.name + data.career);\r\n        if (data.type === 1) {\r\n            $staff_btn.attr(\"class\", \"btn btn-default career-c\");\r\n        } else if (data.type === 2) {\r\n            $staff_btn.attr(\"class\", \"btn btn-default career-assist\");\r\n        } else if (data.type === 3) {\r\n            $staff_btn.attr(\"class\", \"btn btn-default career-priest\");\r\n        } else if (data.type === 0) {\r\n            $staff_btn.attr(\"class\", \"btn btn-default\");\r\n        }\r\n        if (data.absence) {\r\n            $staff_btn.addClass(\"career-absence\");\r\n        }\r\n\r\n        // alert NO AUTH\r\n        $.toast({\r\n            heading: \"无此权限\",\r\n            text: \"体验账号所做修改仅限于页面，不会提交到服务器，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n            showHideTransition: 'fade',\r\n            hideAfter: false,\r\n            icon: \"warning\"\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * delete the corresponding staff button both from page and static json\r\n */\r\nfunction deleteStaff() {\r\n    let id = parseInt($(\"div#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"div#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $(\"button#staff_attr_del_btn\").popover('show');\r\n        return;\r\n    }\r\n\r\n    if (id === 0) {// newly added\r\n        $staff_btn.remove();\r\n        return;\r\n    }\r\n    let textDeleted = $staff_btn.text();\r\n    // submit changes\r\n    if (sessionStorage.authorized === \"true\") {\r\n        $.post(\"php/StaffAttr.php\", {\r\n            \"method\": \"delete\",\r\n            \"id\": id,\r\n            \"auth\": sessionStorage.auth\r\n        }, function (data, status) {\r\n            if (status === \"success\") {\r\n                // success message\r\n                let json = JSON.parse(data);\r\n                if (json.code === 0) {\r\n                    // reload staff list\r\n                    requestStaff(loadCheck);\r\n                    $.toast({\r\n                        heading: \"删除成功\",\r\n                        text: \"已删除<b>\" + textDeleted + \"</b>，<a onclick=\\\"undoDeleteStaff(\" + id + \");$(this).siblings(\\\".close-jq-toast-single\\\").click();\\\">撤销删除</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"success\"\r\n                    });\r\n                } else if (json.code === 5) {\r\n                    // alert NO AUTH\r\n                    $.toast({\r\n                        heading: \"权限不足\",\r\n                        text: \"需要团员以上权限才可操作，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"warning\"\r\n                    });\r\n                } else {\r\n                    $.toast({\r\n                        heading: \"删除失败\",\r\n                        text: json.msg,\r\n                        showHideTransition: 'fade',\r\n                        icon: \"error\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        $staff_btn.remove();\r\n        // delete from static json\r\n        if (parseInt(staticLocalStaffList[id - 1].id) === id) {\r\n            staticLocalStaffList.splice(id - 1, 1);\r\n        } else {\r\n            // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n            alert(\"错误代码602，请告知小明\");\r\n        }\r\n        // alert NO AUTH\r\n        $.toast({\r\n            heading: \"无此权限\",\r\n            text: \"体验账号所做修改仅限于页面，不会提交到服务器，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n            showHideTransition: 'fade',\r\n            hideAfter: false,\r\n            icon: \"warning\"\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * recover the staff just deleted\r\n * @param idDeleted id of the deleted staff\r\n */\r\nfunction undoDeleteStaff(idDeleted) {\r\n    $.post(\"php/StaffAttr.php\", {\r\n        \"method\": \"undo\",\r\n        \"id\": idDeleted,\r\n        \"auth\": sessionStorage.auth\r\n    }, function (data, status) {\r\n        if (status === \"success\") {\r\n            // success message\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // reload staff list\r\n                requestStaff(loadCheck);\r\n                $.toast({\r\n                    text: \"已恢复\",\r\n                    showHideTransition: 'fade',\r\n                    icon: \"info\"\r\n                });\r\n            } else if (json.code === 5) {\r\n                // alert NO AUTH\r\n                $.toast({\r\n                    heading: \"权限不足\",\r\n                    text: \"需要团员以上权限才可操作，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                    showHideTransition: 'fade',\r\n                    hideAfter: false,\r\n                    icon: \"warning\"\r\n                });\r\n            } else {\r\n                $.toast({\r\n                    heading: \"恢复失败\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * premium auth. save schedule changes server\r\n */\r\nfunction saveSchedule() {\r\n    // save schedule\r\n    if (sessionStorage.authorized === \"true\") {\r\n        let content = extractSchedule();\r\n        $.post(\"php/ScheduleSL.php\", {\r\n            \"method\": \"save\",\r\n            \"content\": content,\r\n            \"auth\": sessionStorage.auth\r\n        }, function (data, status) {\r\n            if (status === \"success\") {\r\n                // success message\r\n                let json = JSON.parse(data);\r\n                if (json.code === 0) {\r\n                    $.toast({\r\n                        text: \"保存成功\",\r\n                        showHideTransition: 'fade',\r\n                        icon: \"success\"\r\n                    });\r\n                } else if (json.code === 5) {\r\n                    // alert NO AUTH\r\n                    $.toast({\r\n                        heading: \"无此权限\",\r\n                        text: \"只有团长权限可以保存排表，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"warning\"\r\n                    });\r\n                } else {\r\n                    $.toast({\r\n                        heading: \"保存失败\",\r\n                        text: json.msg,\r\n                        showHideTransition: 'fade',\r\n                        icon: \"error\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        // alert NO AUTH\r\n        $.toast({\r\n            heading: \"无此权限\",\r\n            text: \"体验账号所做修改仅限于页面，不会提交到服务器，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n            showHideTransition: 'fade',\r\n            hideAfter: false,\r\n            icon: \"warning\"\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * extract the whole schedule\r\n * @returns {string} nested array of the schedule\r\n */\r\nfunction extractSchedule() {\r\n    let $schedule = $(\"div#schedule\");\r\n    let scheduleArray = [];\r\n    $schedule.find(\"table\").each(function () {\r\n        let $table = $(this);\r\n        // each table is one period\r\n        let periodArray = [];\r\n        $table.find(\"tbody tr\").each(function () {\r\n            let $tr = $(this);\r\n            // each tr is one team\r\n            let staffArray = [];\r\n            $tr.find(\"td\").each(function () {\r\n                let $td = $(this);\r\n                // each td is one staff\r\n                let id = $td.attr(\"data-id\");\r\n                staffArray.push(id && id > 1 ? id : 0);\r\n            });\r\n            periodArray.push(\"[\" + staffArray.toString() + \"]\");\r\n        });\r\n        scheduleArray.push(\"[\" + periodArray.toString() + \"]\");\r\n    });\r\n    return \"[\" + scheduleArray.toString().toString() + \"]\";\r\n}\r\n\r\n/**\r\n * make the corresponding dom draggable\r\n * @param $object jquery selector, object to be dragged\r\n * @param $handle the move handle\r\n */\r\nfunction makeDraggable($object, $handle) {\r\n    if (!$object instanceof jQuery) {\r\n        return;\r\n    }\r\n    let isMove = false;\r\n    let X, Y;\r\n    $handle.on('mousedown', function (e) {\r\n        isMove = true;\r\n        X = e.pageX - parseInt($object.css(\"left\"));\r\n        Y = e.pageY - parseInt($object.css(\"top\"));\r\n    });\r\n    $(document).on('mousemove', function (e) {\r\n        if (isMove) {\r\n            let left = e.pageX - X;\r\n            let top = e.pageY - Y;\r\n            $object.css({left: left, top: top});\r\n        }\r\n    }).on('mouseup', function () {\r\n        isMove = false;\r\n    });\r\n}\r\n\r\n/**\r\n * when nodes be added to or removed from DOM and the height has changed,\r\n * the svg needs to resize\r\n */\r\nfunction resizeSVG() {\r\n    $('.line').css({width: document.body.scrollWidth, height: document.body.scrollHeight});\r\n}\r\n\r\n/**\r\n * when drag event happening on a staff button, draw a line from start to end\r\n * if the dragging ends within the schedule chart, fill the cell with the staff\r\n *\r\n * add support for exchanging staffs in the schedule\r\n */\r\nfunction bindDrawLine() {\r\n    // reinitialize svg width & height\r\n    $('.line').css({width: document.body.scrollWidth, height: document.body.scrollHeight});\r\n    // bind\r\n    let isDraw = false, isDrop = false, isExchange = false;\r\n    let $svg = $('svg');\r\n    // button\r\n    let staffId;\r\n    // table\r\n    let $td;\r\n    // pick staff\r\n    let $buttons = $(\"div#staff_list\").children('div');\r\n    $buttons.on('mousedown', 'button', function (e) {\r\n        // unlock drawing\r\n        isDraw = true;\r\n        // read staff id\r\n        staffId = parseInt($(e.target).attr('data-id'));\r\n        // draw a line\r\n        $svg.children('line').attr({x1: e.pageX, y1: e.pageY, x2: e.pageX, y2: e.pageY});\r\n    });\r\n    let $schedule = $(\"div#schedule\");\r\n    $schedule.on(\"mousedown\", \"table tr td\", function (e) {\r\n        // unlock drawing\r\n        isDraw = true;\r\n        // exchange flag\r\n        isExchange = true;\r\n        // read staff\r\n        $td = $(e.target);\r\n        // draw a line\r\n        $svg.children('line').attr({x1: e.pageX, y1: e.pageY, x2: e.pageX, y2: e.pageY});\r\n    });\r\n    // draw line\r\n    $(document).on('mousemove', function (e) {\r\n        if (isDraw) {\r\n            if (!$svg.is(':visible')) {\r\n                $svg.show();\r\n            }\r\n            // draw a line\r\n            $svg.children('line').attr({x2: e.pageX, y2: e.pageY});\r\n        }\r\n    }).on('mouseup', function () {\r\n        if (isDraw) {\r\n            isDraw = false;\r\n            $svg.hide();\r\n\r\n            // allow drop\r\n            isDrop = true;\r\n            setTimeout(function () {\r\n                isDrop = false;\r\n            }, 50);\r\n        }\r\n    });\r\n    // drop staff\r\n    $schedule.on('mouseover', 'table tr td', function () {\r\n        if (isDrop) {\r\n            if (isExchange) {\r\n                // exchange\r\n                let staff_id = $td.attr(\"data-id\");\r\n                let staff_name = $td.attr(\"data-name\");\r\n                let staff_text = $td.text();\r\n                let staff_element = $td.attr(\"data-element\");\r\n                let $target = $(this);\r\n                let this_id = $target.attr(\"data-id\");\r\n                let this_name = $target.attr(\"data-name\");\r\n                let this_text = $target.text();\r\n                let this_element = $target.attr(\"data-element\");\r\n                $td.attr(\"data-id\", !this_id ? \"\" : this_id);\r\n                $td.attr(\"data-name\", !this_name ? \"\" : this_name);\r\n                $td.text(!this_text ? \"\" : this_text);\r\n                $td.attr(\"data-element\", !this_element ? \"\" : this_element);\r\n                $target.attr(\"data-id\", !staff_id ? \"\" : staff_id);\r\n                $target.attr(\"data-name\", !staff_name ? \"\" : staff_name);\r\n                $target.text(!staff_text ? \"\" : staff_text);\r\n                $target.attr(\"data-element\", !staff_element ? \"\" : staff_element);\r\n                // reset\r\n                isExchange = false;\r\n                // draw element dots\r\n                translateElement(false, $td);\r\n                translateElement(false, $target);\r\n                // mark duplication\r\n                markDuplicate(false, $td);\r\n                markDuplicate(false, $target);\r\n                return;\r\n            }\r\n            let staff = staticLocalStaffList[staffId - 1];\r\n            if (parseInt(staff.id) === staffId) {\r\n                let id_replaced = parseInt($(this).attr(\"data-id\"));\r\n                let $staff_list = $(\"div#staff_list\");\r\n                // remove duplication\r\n                if (staff.name !== \"空\") {\r\n                    let $contain = $(\"div#schedule\").find(\"tbody tr td\").filter('[data-id=\"' + staffId + '\"]');\r\n                    $contain.each(function () {\r\n                        $(this).removeAttr(\"data-id\").removeAttr(\"data-name\").removeAttr(\"data-element\").text(\"\");\r\n                    });\r\n                }\r\n                // fill in the cell\r\n                $(this).attr('data-id', staffId).attr('data-name', staff.name).attr('data-element', staff.element).text(staff.name + staff.career);\r\n                translateElement(false, $(this));\r\n                // set staff to '.in-schedule'\r\n                let $staff_in = $staff_list.find('button[data-id=\"' + staffId + '\"]');\r\n                if (!$staff_in.hasClass('in-schedule') && staff.name !== \"空\") {\r\n                    $staff_in.addClass('in-schedule');\r\n                    // hide\r\n                    if ($(\"div#staff_list_filter\").find('input[data-filter=4]').prop(\"checked\") === false) {\r\n                        $staff_in.hide();\r\n                    }\r\n                }\r\n                // consider REPLACE\r\n                if (id_replaced > 1) {\r\n                    let $contain = $staff_list.find('button[data-id=\"' + id_replaced + '\"]');\r\n                    $contain.each(function () {\r\n                        $(this).removeClass(\"in-schedule\").show();\r\n                    })\r\n                }\r\n            } else {\r\n                // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n                alert(\"错误代码603，请告知小明\");\r\n            }\r\n            isDrop = false;\r\n            // check duplication partly\r\n            markDuplicate(false, $(this));\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * check duplication in schedule\r\n * @param scale boolean. true:wholly, false:partly. if false, a root object is required\r\n */\r\nfunction markDuplicate(scale) {\r\n    if (scale) {\r\n\r\n    } else {\r\n        if (typeof arguments[1] === \"object\") {\r\n            // recover\r\n            let $obj = arguments[1];\r\n            let $td = $obj.parentsUntil('table').find('td');\r\n            $td.css('color', '');\r\n            // check\r\n            let map = {};\r\n            $.each($td, function () {\r\n                let key = $(this).attr('data-name');\r\n                if (key !== \"空\" && !!key) {\r\n                    if (typeof map[key] === \"undefined\") {\r\n                        map[key] = 1;// first met\r\n                    } else if (map[key] === 1) {\r\n                        $td.filter('[data-name=' + key + ']').css('color', 'red');\r\n                        map[key] = 2;// handled\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            // Error 70x:参数传递错误\r\n            alert(\"错误代码701，请告知小明\");\r\n        }\r\n    }\r\n}\r\n\r\n"]}